<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/favicon.png">
    <title>Available for Sourcing | Dialed By H — Luxury Watch Concierge</title>
    <meta name="description" content="Browse pieces currently available for sourcing through Dialed By H. Rolex Daytona, GMT-Master II, Submariner, Day-Date, Sky-Dweller and more rare references. Inquire to source.">
    <meta name="keywords" content="luxury watch sourcing, source rolex daytona, rolex gmt master, rolex submariner, rolex day date, sky dweller, rare watch sourcing, watch concierge, dialed by h">
    <meta name="author" content="Henry Ohler">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://dialed-by-h.netlify.app/inventory.html">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://dialed-by-h.netlify.app/inventory.html">
    <meta property="og:title" content="Available for Sourcing | Dialed By H">
    <meta property="og:description" content="Browse rare luxury watches available for sourcing through Dialed By H concierge service.">
    <meta property="og:image" content="https://dialed-by-h.netlify.app/images/logo.png">
    <meta property="og:site_name" content="Dialed By H">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Available for Sourcing | Dialed By H">
    <meta name="twitter:description" content="Browse rare luxury watches available for sourcing through Dialed By H.">

    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "CollectionPage",
        "name": "Dialed By H — Pieces for Sourcing",
        "description": "Browse rare and authenticated luxury watches available for concierge sourcing through Dialed By H.",
        "url": "https://dialed-by-h.netlify.app/inventory.html",
        "provider": {
            "@type": "Organization",
            "name": "Dialed By H",
            "url": "https://dialed-by-h.netlify.app"
        }
    }
    </script>

    <link href="https://fonts.googleapis.com/css?family=Google+Sans+Text" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        charcoal: '#0a0a0a',
                        ivory: '#f0f0f0',
                        muted: '#888888',
                    },
                    fontFamily: {
                        space: ['"Space Grotesk"', 'sans-serif'],
                        inter: ['"Inter"', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        @import url(https://fonts.googleapis.com/css?family=Google+Sans+Text);
        html {
            font-family: 'Google Sans Text', 'Google Sans';
            font-size: 14px;
            margin: 0;
            padding: 0;
            background: #0a0a0a;
            color: #f0f0f0;
        }
        body {
            margin: 0;
            padding: 0;
            background-color: #0a0a0a;
            color: #f0f0f0;
            overflow-x: hidden;
            text-transform: uppercase;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        ::-webkit-scrollbar-thumb { background: #333; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .nav-link { position: relative; }
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 1px;
            background: #f0f0f0;
            transition: width 0.3s ease;
        }
        .nav-link:hover::after { width: 100%; }

        .glass {
            background: rgba(255,255,255,0.03);
            backdrop-filter: blur(20px) saturate(1.4);
            -webkit-backdrop-filter: blur(20px) saturate(1.4);
            border: 1px solid rgba(255,255,255,0.08);
        }
        .glass-strong {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(40px) saturate(1.6);
            -webkit-backdrop-filter: blur(40px) saturate(1.6);
            border: 1px solid rgba(255,255,255,0.12);
        }
        .glass-subtle {
            background: rgba(255,255,255,0.02);
            backdrop-filter: blur(12px) saturate(1.2);
            -webkit-backdrop-filter: blur(12px) saturate(1.2);
            border: 1px solid rgba(255,255,255,0.05);
        }
        .orb {
            position: fixed; border-radius: 50%; filter: blur(80px);
            pointer-events: none; z-index: 0; opacity: 0.07;
        }
        .orb-1 {
            width: 500px; height: 500px;
            background: radial-gradient(circle, #4a9eff, transparent 70%);
            top: -10%; left: -5%;
            animation: orb-float-1 20s ease-in-out infinite;
        }
        .orb-2 {
            width: 400px; height: 400px;
            background: radial-gradient(circle, #a855f7, transparent 70%);
            bottom: 10%; right: -8%;
            animation: orb-float-2 25s ease-in-out infinite;
        }
        .orb-3 {
            width: 350px; height: 350px;
            background: radial-gradient(circle, #06b6d4, transparent 70%);
            top: 40%; left: 50%;
            animation: orb-float-3 22s ease-in-out infinite;
        }
        @keyframes orb-float-1 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(80px, 60px) scale(1.1); }
            66% { transform: translate(-40px, 30px) scale(0.95); }
        }
        @keyframes orb-float-2 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(-60px, -40px) scale(1.15); }
            66% { transform: translate(30px, -70px) scale(0.9); }
        }
        @keyframes orb-float-3 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(50px, -50px) scale(1.05); }
            66% { transform: translate(-70px, 40px) scale(1.1); }
        }

        .watch-card {
            position: relative;
            overflow: hidden;
        }
        .watch-card .watch-img {
            transition: transform 0.7s ease, filter 0.7s ease;
        }
        .watch-card:hover .watch-img {
            transform: scale(1.08);
            filter: grayscale(0);
        }
        .watch-card .card-overlay {
            transition: background-color 0.5s ease;
        }
        .watch-card:hover .card-overlay {
            background-color: rgba(10, 10, 10, 0.3);
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .watch-card .inquire-btn {
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.4s ease, transform 0.4s ease;
        }
        .watch-card:hover .inquire-btn {
            opacity: 1;
            transform: translateY(0);
        }

        .modal-hidden {
            visibility: hidden;
            pointer-events: none;
        }
        .modal-visible {
            visibility: visible;
            pointer-events: auto;
        }

        .brand-pill {
            background: rgba(245,243,235,0.04);
            color: rgba(245,243,235,0.35);
            padding: 6px 16px;
            border-radius: 9999px;
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            font-size: 10px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            transition: all 0.25s ease;
            border: 1px solid transparent;
        }
        .brand-pill:hover { background: rgba(245,243,235,0.08); color: rgba(245,243,235,0.6); }
        .brand-pill.active {
            background: rgba(245,243,235,0.1);
            color: rgba(245,243,235,0.95);
            border-color: rgba(245,243,235,0.12);
        }
        .filter-select-wrap select {
            background: transparent;
            border: none;
            outline: none;
            color: rgba(245,243,235,0.45);
            font-family: 'Space Grotesk', sans-serif;
            font-weight: 700;
            font-size: 10px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            cursor: pointer;
            padding: 4px 8px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            transition: color 0.2s ease;
        }
        .filter-select-wrap select:hover,
        .filter-select-wrap select:focus { color: rgba(245,243,235,0.8); }
        .filter-select-wrap select.active-filter { color: rgba(245,243,235,0.95); }
        .filter-select-wrap select option { background: #1a1a1a; color: #f5f3eb; }

        @media (max-width: 639px) {
            .orb { display: none; }
        }
        @media (min-width: 640px) and (max-width: 1023px) {
            .orb-1 { width: 300px; height: 300px; }
            .orb-2 { width: 250px; height: 250px; }
            .orb-3 { width: 200px; height: 200px; }
        }
    </style>
</head>
<body class="min-h-screen bg-charcoal text-ivory selection:bg-ivory selection:text-charcoal font-inter">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>

    <!-- NAV -->
    <nav class="w-full z-40 px-6 sm:px-10 md:px-16 py-5 sm:py-6 flex justify-between items-center relative">
        <a href="index.html">
            <img src="images/logo.png" alt="Dialed By H" class="h-8 sm:h-10 w-auto object-contain">
        </a>
        <div class="hidden md:flex space-x-8 text-sm font-space font-medium uppercase tracking-widest items-center">
            <a href="about.html" class="nav-link hover:text-muted transition-colors">About Me</a>
            <a href="process.html" class="nav-link hover:text-muted transition-colors">My Process</a>
            <a href="https://dialedbyh.substack.com" target="_blank" rel="noopener noreferrer" class="nav-link hover:text-muted transition-colors">Journal</a>
            <a href="index.html" class="bg-ivory text-charcoal px-5 py-2 text-xs font-bold font-space uppercase tracking-widest hover:bg-muted hover:text-white transition-colors">Back to Home</a>
        </div>
        <button onclick="document.getElementById('mobile-menu').style.opacity='1'; document.getElementById('mobile-menu').style.pointerEvents='auto'; document.body.style.overflow='hidden';" class="md:hidden text-ivory">
            <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                <path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/>
            </svg>
        </button>
    </nav>

    <!-- MOBILE MENU -->
    <div id="mobile-menu" class="fixed inset-0 z-50 bg-charcoal/95 backdrop-blur-sm flex flex-col items-center justify-center space-y-8 transition-all duration-500 opacity-0 pointer-events-none">
        <button onclick="document.getElementById('mobile-menu').style.opacity='0'; document.getElementById('mobile-menu').style.pointerEvents='none'; document.body.style.overflow='';" class="absolute top-4 right-6 text-ivory">
            <svg width="28" height="28" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
        </button>
        <a href="about.html" class="text-2xl font-space font-bold uppercase tracking-widest hover:text-muted transition-colors">About Me</a>
        <a href="process.html" class="text-2xl font-space font-bold uppercase tracking-widest hover:text-muted transition-colors">My Process</a>
        <a href="https://dialedbyh.substack.com" target="_blank" rel="noopener noreferrer" class="text-2xl font-space font-bold uppercase tracking-widest hover:text-muted transition-colors">Journal</a>
        <a href="index.html" class="bg-ivory text-charcoal px-8 py-3 text-sm font-bold font-space uppercase tracking-widest hover:bg-muted hover:text-white transition-colors">Back to Home</a>
    </div>

    <!-- HEADER -->
    <div class="max-w-7xl mx-auto px-6 pt-10 sm:pt-16">
        <h1 id="hero-title" class="font-space font-bold text-3xl sm:text-5xl md:text-6xl lg:text-8xl tracking-tighter uppercase leading-none opacity-0">
            Available for <span class="text-muted">Sourcing</span>
        </h1>
    </div>

    <!-- CONTENT -->
    <main class="max-w-7xl mx-auto px-6 pt-12 sm:pt-16 pb-12 sm:pb-16">

        <!-- SUBTITLE -->
        <p id="hero-sub" class="font-inter text-muted text-sm sm:text-base max-w-xl opacity-0 leading-relaxed mb-10 sm:mb-14" style="letter-spacing: 0.15em;">
            Browse pieces I can currently source. Inquire on any reference and I'll handle the rest.
        </p>

        <!-- FILTER SYSTEM -->
        <div class="mb-10 sm:mb-14" id="filter-bar">
            <!-- Model pills — horizontal scroll on mobile, wrap on desktop -->
            <div class="flex sm:flex-wrap gap-2 mb-5 overflow-x-auto no-scrollbar pb-1" id="model-pills">
                <button onclick="selectModel('ALL')" class="brand-pill active shrink-0" data-model="ALL">All</button>
            </div>

            <!-- Filter row -->
            <div class="glass-subtle rounded-xl px-4 sm:px-6 py-3">
                <!-- MOBILE: 2x2 grid + sort row -->
                <div class="sm:hidden">
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <div class="filter-select-wrap">
                            <select id="filter-material-m" onchange="syncFilter('filter-material', this.value); applyFilters()" class="w-full">
                                <option value="ALL">Case Material</option>
                            </select>
                        </div>
                        <div class="filter-select-wrap">
                            <select id="filter-dial-m" onchange="syncFilter('filter-dial', this.value); applyFilters()" class="w-full">
                                <option value="ALL">Dial Color</option>
                            </select>
                        </div>
                        <div class="filter-select-wrap">
                            <select id="filter-condition-m" onchange="syncFilter('filter-condition', this.value); applyFilters()" class="w-full">
                                <option value="ALL">Condition</option>
                            </select>
                        </div>
                        <div class="filter-select-wrap">
                            <select id="filter-set-m" onchange="syncFilter('filter-set', this.value); applyFilters()" class="w-full">
                                <option value="ALL">Set</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex items-center justify-between pt-2 border-t border-ivory/5">
                        <div class="filter-select-wrap">
                            <select id="sort-by-m" onchange="syncFilter('sort-by', this.value); applyFilters()" class="w-full">
                                <option value="default">Sort By</option>
                                <option value="year-new">Newest</option>
                                <option value="year-old">Oldest</option>
                                <option value="model-az">Model A → Z</option>
                            </select>
                        </div>
                        <div class="flex items-center gap-3">
                            <span id="result-count-m" class="text-[10px] font-space tracking-widest text-ivory/25 whitespace-nowrap"></span>
                            <button onclick="resetFilters()" id="reset-btn-m" class="hidden text-[10px] font-space font-bold tracking-widest text-ivory/30 hover:text-ivory transition-colors whitespace-nowrap">
                                ✕ Clear
                            </button>
                        </div>
                    </div>
                </div>

                <!-- DESKTOP: single row -->
                <div class="hidden sm:flex items-center">
                    <div class="flex items-center gap-0 flex-1">
                        <div class="filter-select-wrap flex-1 text-center">
                            <select id="filter-material" onchange="applyFilters()">
                                <option value="ALL">Case Material</option>
                            </select>
                        </div>
                        <span class="text-ivory/10">|</span>
                        <div class="filter-select-wrap flex-1 text-center">
                            <select id="filter-dial" onchange="applyFilters()">
                                <option value="ALL">Dial Color</option>
                            </select>
                        </div>
                        <span class="text-ivory/10">|</span>
                        <div class="filter-select-wrap flex-1 text-center">
                            <select id="filter-condition" onchange="applyFilters()">
                                <option value="ALL">Condition</option>
                            </select>
                        </div>
                        <span class="text-ivory/10">|</span>
                        <div class="filter-select-wrap flex-1 text-center">
                            <select id="filter-set" onchange="applyFilters()">
                                <option value="ALL">Set</option>
                            </select>
                        </div>
                    </div>
                    <span class="text-ivory/10 mx-4">|</span>
                    <div class="flex items-center gap-4 shrink-0">
                        <div class="filter-select-wrap">
                            <select id="sort-by" onchange="applyFilters()">
                                <option value="default">Sort By</option>
                                <option value="year-new">Newest</option>
                                <option value="year-old">Oldest</option>
                                <option value="model-az">Model A → Z</option>
                            </select>
                        </div>
                        <span id="result-count" class="text-[10px] font-space tracking-widest text-ivory/25 whitespace-nowrap"></span>
                        <button onclick="resetFilters()" id="reset-btn" class="hidden text-[10px] font-space font-bold tracking-widest text-ivory/30 hover:text-ivory transition-colors whitespace-nowrap">
                            ✕ Clear
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- WATCH GRID -->
        <div id="watch-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8">
        </div>

        <!-- EMPTY STATE -->
        <div id="empty-state" class="hidden text-center py-20">
            <p class="text-muted font-space tracking-widest text-sm">No pieces match this filter.</p>
        </div>

        <!-- CTA -->
        <div class="mt-16 sm:mt-24 text-center glass rounded-2xl p-8 sm:p-12">
            <h2 class="font-space font-bold text-2xl sm:text-3xl tracking-tight mb-4">Don't See What You're Looking For?</h2>
            <p class="text-muted text-sm sm:text-base font-inter tracking-wide mb-8 max-w-lg mx-auto">
                I source watches globally through my network. Tell me what you're after and I'll find it.
            </p>
            <button onclick="openSourceRequest()" class="bg-ivory text-charcoal px-8 py-4 font-bold font-space uppercase tracking-widest hover:bg-white transition-colors">
                Submit a Sourcing Request
            </button>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="px-6 py-16 sm:py-20 border-t border-ivory/10 text-center overflow-hidden">
        <div class="footer-content">
            <p class="footer-line text-muted text-xs font-space uppercase tracking-[0.3em] mb-4 opacity-0">Authenticated Timepieces. Global Sourcing.</p>
            <div class="footer-line flex justify-center gap-8 sm:gap-12 mb-6 opacity-0">
                <a href="https://www.instagram.com/dialedbyh/" target="_blank" rel="noopener noreferrer" class="text-muted hover:text-ivory transition-colors">
                    <i data-lucide="instagram" class="w-5 h-5"></i>
                </a>
                <a href="https://wa.me/19146211848" target="_blank" rel="noopener noreferrer" class="text-muted hover:text-ivory transition-colors">
                    <i data-lucide="message-circle" class="w-5 h-5"></i>
                </a>
                <a href="mailto:dialedbyh@gmail.com" target="_blank" rel="noopener noreferrer" class="text-muted hover:text-ivory transition-colors">
                    <i data-lucide="mail" class="w-5 h-5"></i>
                </a>
            </div>
            <span class="footer-line text-xs text-muted/60 font-space uppercase tracking-widest opacity-0">&copy; 2026 DIALED BY H</span>
        </div>
    </footer>

    <!-- INQUIRY MODAL -->
    <div id="modal-overlay" class="modal-hidden fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-xl opacity-0">
        <div class="w-full max-w-lg glass-strong m-3 sm:m-4 relative shadow-2xl overflow-hidden rounded-2xl">
            <button onclick="closeModal()"
                    class="absolute top-3 right-3 z-30 w-9 h-9 flex items-center justify-center bg-charcoal/80 backdrop-blur-sm border border-ivory/20 rounded-full text-muted hover:text-ivory hover:bg-charcoal transition-all duration-200">
                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
            </button>
            <div id="modal-body" class="space-y-4"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script>
        let PIECES = [];

        async function fetchPieces() {
            try {
                const res = await fetch('/.netlify/functions/get-inventory');
                if (!res.ok) throw new Error('Failed to fetch');
                PIECES = await res.json();
                return PIECES;
            } catch (err) {
                console.error('Failed to fetch pieces from Notion:', err);
                return [];
            }
        }

        function renderGrid(items) {
            const grid = document.getElementById('watch-grid');
            const empty = document.getElementById('empty-state');

            if (items.length === 0) {
                grid.innerHTML = '';
                empty.classList.remove('hidden');
                return;
            }

            empty.classList.add('hidden');
            grid.innerHTML = items.map(w => {
                const name = w.name || '';
                const ref = w.ref || '';
                const nickname = w.nickname ? `"${w.nickname}"` : '';
                const details = w.details || '';
                const image = w.image || '';
                const setLabel = w.set || '';
                const condLabel = w.condition || '';

                return `
                <div class="watch-card glass rounded-xl cursor-pointer" onclick="openInquiry('${w.id}')" data-model="${w.model}">
                    <div class="relative aspect-square overflow-hidden rounded-t-xl">
                        ${image ? `<img src="${image}" alt="${name}" class="watch-img w-full h-full object-cover grayscale-[30%]" loading="lazy">` : `<div class="w-full h-full bg-charcoal/50 flex items-center justify-center"><span class="text-muted text-xs">No Image</span></div>`}
                        <div class="card-overlay absolute inset-0 bg-charcoal/50"></div>
                        <div class="absolute bottom-4 left-4 right-4">
                            <div class="inquire-btn glass-strong rounded-lg px-4 py-3 text-center">
                                <span class="text-xs font-space font-bold tracking-widest">Inquire to Source</span>
                            </div>
                        </div>
                    </div>
                    <div class="p-5 sm:p-6">
                        <h3 class="font-space font-bold text-lg sm:text-xl tracking-tight mb-1">${name} ${nickname}</h3>
                        ${ref ? `<p class="text-muted text-[11px] font-bold tracking-widest mb-3">Ref. ${ref}</p>` : ''}
                        ${details ? `<p class="text-ivory/50 text-xs font-inter leading-relaxed tracking-wide mb-4">${details}</p>` : ''}
                        <div class="flex items-center justify-between pt-3 border-t border-ivory/10">
                            <div class="flex items-center gap-3">
                                ${condLabel ? `<span class="text-[10px] font-space font-bold tracking-widest text-ivory/40">${condLabel}</span>` : ''}
                                ${setLabel ? `<span class="text-[10px] font-space tracking-widest text-ivory/30">${setLabel}</span>` : ''}
                            </div>
                            <div class="w-8 h-8 border border-ivory/20 rounded-full flex items-center justify-center">
                                <i data-lucide="arrow-up-right" class="w-4 h-4 text-ivory/60"></i>
                            </div>
                        </div>
                    </div>
                </div>
            `}).join('');

            lucide.createIcons();
        }

        // Sync mobile/desktop filter values
        function syncFilter(desktopId, value) {
            const el = document.getElementById(desktopId);
            if (el) el.value = value;
        }

        let activeModel = 'ALL';

        function selectModel(model) {
            activeModel = model;
            document.querySelectorAll('.brand-pill').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.model === model);
            });
            applyFilters();
        }

        function highlightActiveSelects() {
            ['filter-material', 'filter-dial', 'filter-condition', 'filter-set', 'sort-by'].forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                el.classList.toggle('active-filter', el.value !== 'ALL' && el.value !== 'default');
            });
        }

        function isFiltered() {
            return activeModel !== 'ALL' ||
                document.getElementById('filter-material').value !== 'ALL' ||
                document.getElementById('filter-dial').value !== 'ALL' ||
                document.getElementById('filter-condition').value !== 'ALL' ||
                document.getElementById('filter-set').value !== 'ALL' ||
                document.getElementById('sort-by').value !== 'default';
        }

        function applyFilters() {
            let filtered = [...PIECES];

            if (activeModel !== 'ALL') filtered = filtered.filter(w => w.model === activeModel);

            const mat = document.getElementById('filter-material').value;
            if (mat !== 'ALL') filtered = filtered.filter(w => w.caseMaterial === mat);

            const dial = document.getElementById('filter-dial').value;
            if (dial !== 'ALL') filtered = filtered.filter(w => w.dialColor === dial);

            const cond = document.getElementById('filter-condition').value;
            if (cond !== 'ALL') filtered = filtered.filter(w => w.condition === cond);

            const set = document.getElementById('filter-set').value;
            if (set !== 'ALL') filtered = filtered.filter(w => w.set === set);

            const sort = document.getElementById('sort-by').value;
            if (sort === 'year-new') filtered.sort((a, b) => (Number(b.year) || 0) - (Number(a.year) || 0));
            if (sort === 'year-old') filtered.sort((a, b) => (Number(a.year) || 0) - (Number(b.year) || 0));
            if (sort === 'model-az') filtered.sort((a, b) => (a.model || '').localeCompare(b.model || ''));

            const countText = filtered.length + ' piece' + (filtered.length !== 1 ? 's' : '');
            ['result-count', 'result-count-m'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.textContent = countText;
            });
            const hasFilters = isFiltered();
            ['reset-btn', 'reset-btn-m'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.classList.toggle('hidden', !hasFilters);
            });
            highlightActiveSelects();
            renderGrid(filtered);

            gsap.from('#watch-grid .watch-card', {
                opacity: 0, y: 30, duration: 0.5, stagger: 0.06, ease: 'power2.out'
            });
        }

        function resetFilters() {
            activeModel = 'ALL';
            document.querySelectorAll('.brand-pill').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.model === 'ALL');
            });
            ['filter-material','filter-dial','filter-condition','filter-set'].forEach(id => {
                const d = document.getElementById(id);
                const m = document.getElementById(id + '-m');
                if (d) d.value = 'ALL';
                if (m) m.value = 'ALL';
            });
            const sb = document.getElementById('sort-by');
            const sbm = document.getElementById('sort-by-m');
            if (sb) sb.value = 'default';
            if (sbm) sbm.value = 'default';
            applyFilters();
        }

        // INQUIRY MODAL — Sourcing
        function openInquiry(pieceId) {
            const piece = PIECES.find(w => w.id === pieceId);
            if (!piece) return;

            const overlay = document.getElementById('modal-overlay');
            const body = document.getElementById('modal-body');
            const displayName = piece.name + (piece.nickname ? ' "' + piece.nickname + '"' : '');

            body.innerHTML = `
                <div id="form-view">
                    ${piece.image ? `<div class="w-full h-64 sm:h-72 overflow-hidden"><img src="${piece.image}" class="w-full h-full object-cover"></div>` : ''}
                    <div class="p-5 sm:p-8 space-y-5">
                        <div>
                            <h2 class="text-2xl sm:text-3xl font-space font-bold tracking-tight mb-1">${displayName}</h2>
                            ${piece.ref ? `<p class="text-muted font-bold tracking-widest text-xs">Ref. ${piece.ref}</p>` : ''}
                        </div>
                        ${piece.details ? `<p class="text-ivory/60 text-xs font-inter leading-relaxed tracking-wide">${piece.details}</p>` : ''}
                        <div class="border-t border-ivory/10 pt-5">
                            <p class="text-sm font-inter text-ivory/80 leading-relaxed mb-5">
                                Interested in this piece? Provide your details and I'll reach out with sourcing information.
                            </p>
                            <form onsubmit="event.preventDefault(); submitInquiry(this, '${displayName.replace(/'/g, "\\'")}', '${piece.ref}');" class="space-y-4">
                                <div>
                                    <label class="block text-[10px] font-bold tracking-widest text-muted mb-2">Full Name</label>
                                    <input required type="text" name="fullName" class="w-full bg-transparent border border-ivory/20 p-3 text-ivory focus:border-ivory outline-none transition-colors uppercase">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold tracking-widest text-muted mb-2">Email</label>
                                    <input required type="email" name="email" class="w-full bg-transparent border border-ivory/20 p-3 text-ivory focus:border-ivory outline-none transition-colors uppercase">
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold tracking-widest text-muted mb-2">Message (Optional)</label>
                                    <textarea rows="2" name="message" placeholder="Questions about condition, timeline, etc." class="w-full bg-transparent border border-ivory/20 p-3 text-ivory focus:border-ivory outline-none transition-colors uppercase placeholder-muted/40"></textarea>
                                </div>
                                <button type="submit" class="w-full bg-ivory text-charcoal py-4 font-bold font-space tracking-widest hover:bg-white transition-colors">
                                    Inquire to Source
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                <div id="success-view" class="hidden flex flex-col items-center justify-center py-10 text-center p-5 sm:p-8">
                    <div class="w-16 h-16 border border-ivory rounded-full flex items-center justify-center mb-6">
                        <i data-lucide="check" class="w-8 h-8"></i>
                    </div>
                    <h3 class="text-xl font-space font-bold tracking-widest mb-2">Inquiry Received</h3>
                    <p class="text-muted text-xs tracking-wide">I'll get back to you shortly about the ${displayName}.</p>
                </div>
            `;

            lucide.createIcons();
            overlay.classList.remove('modal-hidden');
            overlay.classList.add('modal-visible');
            gsap.to(overlay, { opacity: 1, duration: 0.4, ease: 'power2.out' });
            gsap.fromTo(overlay.querySelector(':scope > div'),
                { y: 20, opacity: 0, scale: 0.98 },
                { y: 0, opacity: 1, scale: 1, duration: 0.5, ease: 'power3.out' }
            );
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            const overlay = document.getElementById('modal-overlay');
            gsap.to(overlay.querySelector(':scope > div'),
                { y: 20, opacity: 0, scale: 0.98, duration: 0.3, ease: 'power2.in' }
            );
            gsap.to(overlay, {
                opacity: 0, duration: 0.4, delay: 0.1,
                onComplete: () => {
                    overlay.classList.remove('modal-visible');
                    overlay.classList.add('modal-hidden');
                    document.body.style.overflow = '';
                }
            });
        }

        const WATCH_BRANDS = {
            'Rolex': ['Daytona','Submariner','GMT-Master II','Explorer','Explorer II','Datejust','Day-Date','Sky-Dweller','Yacht-Master','Sea-Dweller','Milgauss','Air-King','Cellini','Other'],
            'Patek Philippe': ['Nautilus','Aquanaut','Calatrava','Grand Complications','Complications','Twenty~4','Golden Ellipse','Other'],
            'Audemars Piguet': ['Royal Oak','Royal Oak Offshore','Royal Oak Concept','Code 11.59','Millenary','Other'],
            'Richard Mille': ['RM 11','RM 35','RM 55','RM 67','RM 17','RM 27','RM 72','Other'],
            'F.P. Journe': ['Chronometre Bleu','Chronometre Souverain','Octa','Tourbillon Souverain','Centigraphe','Elegante','Other'],
            'Vacheron Constantin': ['Overseas','Patrimony','Traditionnelle','Historiques','Fiftysix','Other'],
            'A. Lange & Sohne': ['Lange 1','Saxonia','Zeitwerk','Datograph','1815','Odysseus','Other'],
            'Omega': ['Speedmaster','Seamaster','Constellation','De Ville','Aqua Terra','Planet Ocean','Other'],
            'Cartier': ['Santos','Tank','Ballon Bleu','Panthere','Pasha','Drive','Other'],
            'IWC': ['Portugieser','Pilot','Aquatimer','Ingenieur','Portofino','Other'],
            'Panerai': ['Luminor','Submersible','Radiomir','Due','Other'],
            'Hublot': ['Big Bang','Classic Fusion','Spirit of Big Bang','Other'],
            'Tudor': ['Black Bay','Pelagos','Ranger','1926','Other'],
            'Breitling': ['Navitimer','Chronomat','Superocean','Avenger','Premier','Other'],
            'Jaeger-LeCoultre': ['Reverso','Master','Polaris','Atmos','Other'],
            'Blancpain': ['Fifty Fathoms','Villeret','Ladybird','Other'],
            'Breguet': ['Classique','Marine','Tradition','Type XX','Other'],
            'Girard-Perregaux': ['Laureato','1966','Bridges','Other'],
            'Other': ['Other']
        };

        function updateModels(brand) {
            const select = document.getElementById('model-select');
            const models = WATCH_BRANDS[brand] || [];
            select.innerHTML = '<option value="" class="bg-charcoal">Select Model</option>' +
                models.map(m => '<option value="'+m+'" class="bg-charcoal">'+m+'</option>').join('');
        }

        function openSourceRequest() {
            const overlay = document.getElementById('modal-overlay');
            const body = document.getElementById('modal-body');

            body.innerHTML = `
                <div id="form-view" class="p-5 sm:p-8">
                    <h2 class="text-2xl font-space font-bold tracking-tight mb-2">Sourcing Request</h2>
                    <p class="text-xs text-muted mb-8 tracking-wide">Tell me what you're looking for and I'll source it.</p>
                    <form onsubmit="event.preventDefault(); submitSourceRequest(this);" class="space-y-4">
                        <div>
                            <label class="block text-[10px] font-bold tracking-widest text-muted mb-2">Full Name</label>
                            <input required type="text" name="fullName" class="w-full bg-transparent border border-ivory/20 p-3 text-ivory focus:border-ivory outline-none transition-colors uppercase">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold tracking-widest text-muted mb-2">Email</label>
                            <input required type="email" name="email" class="w-full bg-transparent border border-ivory/20 p-3 text-ivory focus:border-ivory outline-none transition-colors uppercase">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold tracking-widest text-muted mb-2">Brand</label>
                            <select name="watchBrand" required onchange="updateModels(this.value)"
                                class="w-full bg-charcoal border border-ivory/20 p-3 text-ivory focus:border-ivory outline-none transition-colors uppercase appearance-none cursor-pointer">
                                <option value="" class="bg-charcoal">Select Brand</option>
                                ${Object.keys(WATCH_BRANDS).map(b => '<option value="'+b+'" class="bg-charcoal">'+b+'</option>').join('')}
                            </select>
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold tracking-widest text-muted mb-2">Model</label>
                            <select name="watchModel" required id="model-select"
                                class="w-full bg-charcoal border border-ivory/20 p-3 text-ivory focus:border-ivory outline-none transition-colors uppercase appearance-none cursor-pointer">
                                <option value="" class="bg-charcoal">Select Brand First</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold tracking-widest text-muted mb-2">Reference Number (if known)</label>
                            <input type="text" name="watchRef" placeholder="e.g. 126500LN" class="w-full bg-transparent border border-ivory/20 p-3 text-ivory focus:border-ivory outline-none transition-colors uppercase placeholder-muted/40">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold tracking-widest text-muted mb-2">Additional Details</label>
                            <textarea rows="2" name="watchDetails" placeholder="Condition, box & papers, budget, timeline, etc." class="w-full bg-transparent border border-ivory/20 p-3 text-ivory focus:border-ivory outline-none transition-colors uppercase placeholder-muted/40"></textarea>
                        </div>
                        <button type="submit" class="w-full bg-ivory text-charcoal py-4 font-bold font-space tracking-widest hover:bg-white transition-colors mt-4">
                            Submit Sourcing Request
                        </button>
                    </form>
                </div>
                <div id="success-view" class="hidden flex flex-col items-center justify-center py-10 text-center p-5 sm:p-8">
                    <div class="w-16 h-16 border border-ivory rounded-full flex items-center justify-center mb-6">
                        <i data-lucide="check" class="w-8 h-8"></i>
                    </div>
                    <h3 class="text-xl font-space font-bold tracking-widest mb-2">Request Received</h3>
                    <p class="text-muted text-xs tracking-wide">I'll reach out shortly with sourcing options.</p>
                </div>
            `;

            lucide.createIcons();
            overlay.classList.remove('modal-hidden');
            overlay.classList.add('modal-visible');
            gsap.to(overlay, { opacity: 1, duration: 0.4, ease: 'power2.out' });
            gsap.fromTo(overlay.querySelector(':scope > div'),
                { y: 20, opacity: 0, scale: 0.98 },
                { y: 0, opacity: 1, scale: 1, duration: 0.5, ease: 'power3.out' }
            );
            document.body.style.overflow = 'hidden';
        }

        function showSuccess() {
            const formView = document.getElementById('form-view');
            const successView = document.getElementById('success-view');
            if (formView && successView) {
                gsap.to(formView, {
                    opacity: 0, height: 0, duration: 0.3,
                    onComplete: () => {
                        formView.style.display = 'none';
                        successView.classList.remove('hidden');
                        successView.classList.add('flex');
                        gsap.fromTo(successView, { opacity: 0, y: 10 },
                            { opacity: 1, y: 0, duration: 0.4, ease: 'expo.out' }
                        );
                    }
                });
            }
        }

        async function submitSourceRequest(formEl) {
            const btn = formEl.querySelector('button[type="submit"]');
            const formData = new FormData(formEl);
            const brand = formData.get('watchBrand') || '';
            const model = formData.get('watchModel') || '';
            const ref = formData.get('watchRef') || '';
            const details = formData.get('watchDetails') || '';

            let watchDetailsStr = details;
            if (brand || model) {
                const parts = [brand, model, ref ? 'Ref: ' + ref : ''].filter(Boolean);
                watchDetailsStr = parts.join(' — ') + (details ? ' | ' + details : '');
            }

            const payload = {
                type: 'BUY',
                fullName: formData.get('fullName'),
                email: formData.get('email'),
                watchName: brand && model ? brand + ' ' + model : null,
                watchRef: ref || null,
                watchDetails: watchDetailsStr || null
            };

            if (btn) { btn.innerText = 'Processing...'; btn.disabled = true; }

            try {
                const res = await fetch('/.netlify/functions/submit-form', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!res.ok) throw new Error('Submission failed');
                showSuccess();
            } catch (error) {
                console.error('Submission error:', error);
                if (window.location.protocol === 'file:' || (window.location.hostname === 'localhost' && error.message.includes('Failed to fetch'))) {
                    showSuccess();
                    return;
                }
                if (btn) { btn.innerText = 'Error - Try Again'; btn.disabled = false; }
            }
        }

        async function submitInquiry(formEl, watchName, watchRef) {
            const btn = formEl.querySelector('button[type="submit"]');
            const formData = new FormData(formEl);

            const payload = {
                type: 'WATCH_DETAIL',
                fullName: formData.get('fullName'),
                email: formData.get('email'),
                watchName: watchName,
                watchRef: watchRef,
                watchDetails: formData.get('message') || null
            };

            if (btn) { btn.innerText = 'Processing...'; btn.disabled = true; }

            try {
                const res = await fetch('/.netlify/functions/submit-form', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!res.ok) throw new Error('Submission failed');
                showSuccess();
            } catch (error) {
                console.error('Submission error:', error);
                if (window.location.protocol === 'file:' || (window.location.hostname === 'localhost' && error.message.includes('Failed to fetch'))) {
                    showSuccess();
                    return;
                }
                if (btn) { btn.innerText = 'Error - Try Again'; btn.disabled = false; }
            }
        }

        // INIT
        document.addEventListener('DOMContentLoaded', async () => {
            lucide.createIcons();
            gsap.registerPlugin(ScrollTrigger);

            gsap.from('nav', { opacity: 0, y: -30, duration: 1, ease: 'power3.out' });

            gsap.to('#hero-title', {
                opacity: 1, y: 0, duration: 1.2, ease: 'expo.out', delay: 0.3
            });
            gsap.from('#hero-title', {
                y: 80, duration: 1.2, ease: 'expo.out', delay: 0.3
            });

            gsap.to('#hero-sub', {
                opacity: 1, y: 0, duration: 0.8, ease: 'power2.out', delay: 0.7
            });
            gsap.from('#hero-sub', {
                y: 30, duration: 0.8, ease: 'power2.out', delay: 0.7
            });

            await fetchPieces();

            // Build model pills from data
            const models = [...new Set(PIECES.map(w => w.model).filter(Boolean))].sort();
            const pillContainer = document.getElementById('model-pills');
            models.forEach(m => {
                const btn = document.createElement('button');
                btn.onclick = () => selectModel(m);
                btn.className = 'brand-pill shrink-0';
                btn.dataset.model = m;
                btn.textContent = m;
                pillContainer.appendChild(btn);
            });

            // Populate Case Material dropdown
            const materials = [...new Set(PIECES.map(w => w.caseMaterial).filter(Boolean))].sort();
            ['filter-material', 'filter-material-m'].forEach(id => {
                const sel = document.getElementById(id);
                if (!sel) return;
                materials.forEach(m => {
                    const opt = document.createElement('option');
                    opt.value = m; opt.textContent = m;
                    sel.appendChild(opt);
                });
            });

            // Populate Dial Color dropdown
            const dials = [...new Set(PIECES.map(w => w.dialColor).filter(Boolean))].sort();
            ['filter-dial', 'filter-dial-m'].forEach(id => {
                const sel = document.getElementById(id);
                if (!sel) return;
                dials.forEach(d => {
                    const opt = document.createElement('option');
                    opt.value = d; opt.textContent = d;
                    sel.appendChild(opt);
                });
            });

            // Populate Condition dropdown
            const conditions = [...new Set(PIECES.map(w => w.condition).filter(Boolean))].sort();
            ['filter-condition', 'filter-condition-m'].forEach(id => {
                const sel = document.getElementById(id);
                if (!sel) return;
                conditions.forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c; opt.textContent = c;
                    sel.appendChild(opt);
                });
            });

            // Populate Set dropdown
            const sets = [...new Set(PIECES.map(w => w.set).filter(Boolean))].sort();
            ['filter-set', 'filter-set-m'].forEach(id => {
                const sel = document.getElementById(id);
                if (!sel) return;
                sets.forEach(s => {
                    const opt = document.createElement('option');
                    opt.value = s; opt.textContent = s;
                    sel.appendChild(opt);
                });
            });

            renderGrid(PIECES);
            const rc = document.getElementById('result-count');
            if (rc) rc.textContent = PIECES.length + ' pieces';

            gsap.from('#watch-grid .watch-card', {
                opacity: 0, y: 50, scale: 0.97, duration: 0.7, stagger: 0.1, ease: 'power3.out',
                scrollTrigger: { trigger: '#watch-grid', start: 'top 85%' }
            });

            gsap.from('.glass.rounded-2xl', {
                scrollTrigger: { trigger: '.glass.rounded-2xl', start: 'top 85%' },
                opacity: 0, y: 40, duration: 0.9, ease: 'power3.out'
            });

            gsap.to('.footer-line', {
                opacity: 1, y: 0, duration: 0.6, stagger: 0.15, ease: 'power2.out',
                scrollTrigger: { trigger: 'footer', start: 'top 90%' }
            });
            gsap.from('.footer-line', {
                y: 20, duration: 0.6, stagger: 0.15, ease: 'power2.out',
                scrollTrigger: { trigger: 'footer', start: 'top 90%' }
            });
        });
    </script>
</body>
</html>
