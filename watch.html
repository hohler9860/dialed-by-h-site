<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/favicon.png">
    <title>Watch Detail | Dialed By H</title>
    <meta name="description" content="View details and inquire about this authenticated luxury timepiece from Dialed By H.">
    <meta name="robots" content="index, follow">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Watch Detail | Dialed By H">
    <meta property="og:description" content="Authenticated luxury timepiece available through Dialed By H concierge sourcing.">
    <meta property="og:image" content="https://dialed-by-h.netlify.app/images/logo.png">
    <meta property="og:site_name" content="Dialed By H">

    <link href="https://fonts.googleapis.com/css?family=Google+Sans+Text" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        charcoal: '#0a0a0a',
                        ivory: '#f0f0f0',
                        muted: '#888888',
                    },
                    fontFamily: {
                        space: ['"Space Grotesk"', 'sans-serif'],
                        inter: ['"Inter"', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        @import url(https://fonts.googleapis.com/css?family=Google+Sans+Text);
        html {
            font-family: 'Google Sans Text', 'Google Sans';
            font-size: 14px;
            margin: 0; padding: 0;
            background: #0a0a0a; color: #f0f0f0;
        }
        body {
            margin: 0; padding: 0;
            background-color: #0a0a0a; color: #f0f0f0;
            overflow-x: hidden;
            text-transform: uppercase;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        ::-webkit-scrollbar-thumb { background: #333; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .nav-link { position: relative; }
        .nav-link::after {
            content: ''; position: absolute; bottom: -2px; left: 0;
            width: 0; height: 1px; background: #f0f0f0; transition: width 0.3s ease;
        }
        .nav-link:hover::after { width: 100%; }

        .glass {
            background: rgba(255,255,255,0.03);
            backdrop-filter: blur(20px) saturate(1.4);
            -webkit-backdrop-filter: blur(20px) saturate(1.4);
            border: 1px solid rgba(255,255,255,0.08);
        }
        .glass-strong {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(40px) saturate(1.6);
            -webkit-backdrop-filter: blur(40px) saturate(1.6);
            border: 1px solid rgba(255,255,255,0.12);
        }
        .glass-subtle {
            background: rgba(255,255,255,0.02);
            backdrop-filter: blur(12px) saturate(1.2);
            -webkit-backdrop-filter: blur(12px) saturate(1.2);
            border: 1px solid rgba(255,255,255,0.05);
        }
        .orb {
            position: fixed; border-radius: 50%; filter: blur(80px);
            pointer-events: none; z-index: 0; opacity: 0.07;
        }
        .orb-1 {
            width: 500px; height: 500px;
            background: radial-gradient(circle, #4a9eff, transparent 70%);
            top: -10%; left: -5%;
            animation: orb-float-1 20s ease-in-out infinite;
        }
        .orb-2 {
            width: 400px; height: 400px;
            background: radial-gradient(circle, #a855f7, transparent 70%);
            bottom: 10%; right: -8%;
            animation: orb-float-2 25s ease-in-out infinite;
        }
        .orb-3 {
            width: 350px; height: 350px;
            background: radial-gradient(circle, #06b6d4, transparent 70%);
            top: 40%; left: 50%;
            animation: orb-float-3 22s ease-in-out infinite;
        }
        @keyframes orb-float-1 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(80px, 60px) scale(1.1); }
            66% { transform: translate(-40px, 30px) scale(0.95); }
        }
        @keyframes orb-float-2 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(-60px, -40px) scale(1.15); }
            66% { transform: translate(30px, -70px) scale(0.9); }
        }
        @keyframes orb-float-3 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(50px, -50px) scale(1.05); }
            66% { transform: translate(-70px, 40px) scale(1.1); }
        }

        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='none' stroke='%23888' stroke-width='2' viewBox='0 0 24 24'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
        }

        /* ── RESPONSIVE ── */
        @media (max-width: 639px) {
            .orb { display: none; }
        }
        @media (min-width: 640px) and (max-width: 1023px) {
            .orb-1 { width: 300px; height: 300px; }
            .orb-2 { width: 250px; height: 250px; }
            .orb-3 { width: 200px; height: 200px; }
        }

        .detail-img {
            transition: transform 0.8s ease;
        }
        .detail-img:hover {
            transform: scale(1.03);
        }
    </style>
</head>
<body class="min-h-screen bg-charcoal text-ivory selection:bg-ivory selection:text-charcoal font-inter">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>

    <!-- NAV -->
    <nav class="w-full z-40 px-6 sm:px-10 md:px-16 py-5 sm:py-6 flex justify-between items-center relative">
        <a href="index.html">
            <img src="images/logo.png" alt="Dialed By H" class="h-8 sm:h-10 w-auto object-contain">
        </a>
        <div class="hidden md:flex space-x-8 text-sm font-space font-medium uppercase tracking-widest items-center">
            <a href="about.html" class="nav-link hover:text-muted transition-colors">About Me</a>
            <a href="process.html" class="nav-link hover:text-muted transition-colors">My Process</a>
            <a href="journal.html" class="nav-link hover:text-muted transition-colors">Journal</a>
            <a href="inventory.html" class="bg-ivory text-charcoal px-5 py-2 text-xs font-bold font-space uppercase tracking-widest hover:bg-muted hover:text-white transition-colors">Back to Inventory</a>
        </div>
        <button onclick="document.getElementById('mobile-menu').style.opacity='1'; document.getElementById('mobile-menu').style.pointerEvents='auto'; document.body.style.overflow='hidden';" class="md:hidden text-ivory">
            <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                <path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/>
            </svg>
        </button>
    </nav>

    <!-- MOBILE MENU -->
    <div id="mobile-menu" class="fixed inset-0 z-50 bg-charcoal/95 backdrop-blur-sm flex flex-col items-center justify-center space-y-8 transition-all duration-500 opacity-0 pointer-events-none">
        <button onclick="document.getElementById('mobile-menu').style.opacity='0'; document.getElementById('mobile-menu').style.pointerEvents='none'; document.body.style.overflow='';" class="absolute top-4 right-6 text-ivory">
            <svg width="28" height="28" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
        </button>
        <a href="about.html" class="text-2xl font-space font-bold uppercase tracking-widest hover:text-muted transition-colors">About Me</a>
        <a href="process.html" class="text-2xl font-space font-bold uppercase tracking-widest hover:text-muted transition-colors">My Process</a>
        <a href="journal.html" class="text-2xl font-space font-bold uppercase tracking-widest hover:text-muted transition-colors">Journal</a>
        <a href="inventory.html" class="bg-ivory text-charcoal px-8 py-3 text-sm font-bold font-space uppercase tracking-widest hover:bg-muted hover:text-white transition-colors">Back to Inventory</a>
    </div>

    <!-- MAIN CONTENT -->
    <main id="watch-detail" class="max-w-6xl mx-auto px-6 py-10 sm:py-16">
        <!-- Populated by JS -->
    </main>

    <!-- FOOTER -->
    <footer class="px-6 py-8 border-t border-ivory/10 text-center">
        <span class="text-xs text-muted font-space uppercase tracking-widest">&copy; 2026 DIALED BY H</span>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script>
        // Fetch single watch from Notion API
        let currentWatch = null;

        async function fetchWatch() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            if (!id) return null;
            try {
                const res = await fetch(`/.netlify/functions/get-inventory?id=${id}`);
                if (!res.ok) return null;
                return await res.json();
            } catch (err) {
                console.error('Failed to fetch watch:', err);
                return null;
            }
        }

        /* kept for backward compat with submitInquiry */
        function getWatchFromURL() { return currentWatch; }

        function renderWatchDetail(watch) {
            if (!watch) {
                document.getElementById('watch-detail').innerHTML = `
                    <div class="text-center py-20">
                        <h2 class="font-space font-bold text-3xl tracking-tight mb-4">Watch Not Found</h2>
                        <p class="text-muted text-sm mb-8">This piece may no longer be available.</p>
                        <a href="inventory.html" class="inline-block bg-ivory text-charcoal px-8 py-4 font-bold font-space uppercase tracking-widest hover:bg-white transition-colors">Browse Inventory</a>
                    </div>
                `;
                return;
            }

            // Update page title
            document.title = `${watch.name} — Ref. ${watch.ref} | Dialed By H`;

            // Build specs from client-facing fields
            const specEntries = [
                ['Brand', watch.brand],
                ['Model', watch.model],
                ['Reference', watch.ref],
                ['Year', watch.year],
                ['Case Material', watch.material],
                ['Case Size', watch.caseSize],
                ['Dial', watch.dial],
                ['Condition', watch.condition],
                ['Contents', watch.contents]
            ].filter(([, val]) => val); // only show fields that have values

            const specsHTML = specEntries.map(([key, val]) => `
                <div class="flex justify-between items-start py-3 border-b border-ivory/5">
                    <span class="text-muted text-xs font-bold tracking-widest">${key}</span>
                    <span class="text-ivory text-xs font-space tracking-wide text-right max-w-[55%]">${val}</span>
                </div>
            `).join('');

            document.getElementById('watch-detail').innerHTML = `
                <!-- BREADCRUMB -->
                <div class="mb-8">
                    <a href="inventory.html" class="text-muted text-xs font-space tracking-widest hover:text-ivory transition-colors inline-flex items-center gap-2">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 12H5m0 0l7 7m-7-7l7-7"/></svg>
                        Back to Inventory
                    </a>
                </div>

                <!-- TWO COLUMN LAYOUT -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 lg:gap-16">
                    <!-- LEFT: IMAGE -->
                    <div class="relative">
                        <div class="glass rounded-2xl overflow-hidden">
                            <img src="${watch.image}" alt="${watch.name}" class="detail-img w-full aspect-square object-cover">
                        </div>
                        <div class="absolute top-4 right-4">
                            <span class="glass-strong rounded-full px-4 py-2 text-[10px] font-space font-bold tracking-widest">${watch.status}</span>
                        </div>
                    </div>

                    <!-- RIGHT: INFO -->
                    <div class="flex flex-col">
                        <div class="mb-6">
                            <p class="text-muted text-[11px] font-bold tracking-[0.2em] mb-2">${watch.brand}</p>
                            <h1 class="font-space font-bold text-2xl sm:text-3xl md:text-4xl lg:text-5xl tracking-tighter leading-[0.95] mb-3">${watch.name}</h1>
                            <p class="text-muted text-sm font-bold tracking-widest">Ref. ${watch.ref}</p>
                        </div>

                        <p class="text-ivory/70 text-sm font-inter leading-relaxed tracking-wide mb-8">${watch.details}</p>

                        <div class="glass rounded-xl p-6 mb-8">
                            <div class="flex items-center justify-between mb-5 pb-4 border-b border-ivory/10">
                                <span class="text-xs font-space font-bold tracking-widest text-muted">Price</span>
                                <span class="text-xl font-space font-bold tracking-tight">${watch.price}</span>
                            </div>
                            <button onclick="document.getElementById('inquiry-section').scrollIntoView({behavior:'smooth'})"
                                class="w-full bg-ivory text-charcoal py-4 font-bold font-space uppercase tracking-widest hover:bg-white transition-colors">
                                Inquire About This Piece
                            </button>
                        </div>

                        <!-- TRUST BADGES -->
                        <div class="flex flex-wrap gap-3 mb-8">
                            <div class="glass-subtle rounded-lg px-4 py-2 flex items-center gap-2">
                                <i data-lucide="shield-check" class="w-4 h-4 text-ivory/60"></i>
                                <span class="text-[10px] font-bold tracking-widest text-ivory/60">Authenticated</span>
                            </div>
                            <div class="glass-subtle rounded-lg px-4 py-2 flex items-center gap-2">
                                <i data-lucide="package" class="w-4 h-4 text-ivory/60"></i>
                                <span class="text-[10px] font-bold tracking-widest text-ivory/60">Insured Shipping</span>
                            </div>
                            <div class="glass-subtle rounded-lg px-4 py-2 flex items-center gap-2">
                                <i data-lucide="lock" class="w-4 h-4 text-ivory/60"></i>
                                <span class="text-[10px] font-bold tracking-widest text-ivory/60">Secure Transaction</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SPECIFICATIONS -->
                <div class="mt-16 sm:mt-20">
                    <h2 class="font-space font-bold text-2xl sm:text-3xl tracking-tight mb-8">Specifications</h2>
                    <div class="glass rounded-xl p-6 sm:p-8">
                        ${specsHTML}
                    </div>
                </div>

                <!-- INQUIRY FORM -->
                <div id="inquiry-section" class="mt-16 sm:mt-20 scroll-mt-8">
                    <h2 class="font-space font-bold text-2xl sm:text-3xl tracking-tight mb-4">Inquire About This Piece</h2>
                    <p class="text-muted text-sm font-inter tracking-wide mb-8 max-w-lg">Provide your details and I'll get back to you with availability, pricing, and next steps.</p>
                    <div class="glass rounded-xl p-6 sm:p-8 max-w-xl">
                        <form id="inquiry-form" onsubmit="event.preventDefault(); submitInquiry(this);" class="space-y-5">
                            <div>
                                <label class="block text-[10px] font-bold tracking-widest text-muted mb-2">Full Name</label>
                                <input required type="text" name="fullName" class="w-full bg-transparent border border-ivory/20 p-3 text-ivory focus:border-ivory outline-none transition-colors uppercase">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold tracking-widest text-muted mb-2">Email</label>
                                <input required type="email" name="email" class="w-full bg-transparent border border-ivory/20 p-3 text-ivory focus:border-ivory outline-none transition-colors uppercase">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold tracking-widest text-muted mb-2">Message (Optional)</label>
                                <textarea rows="3" name="message" placeholder="Questions about condition, delivery, pricing, etc." class="w-full bg-transparent border border-ivory/20 p-3 text-ivory focus:border-ivory outline-none transition-colors uppercase placeholder-muted/40"></textarea>
                            </div>
                            <button type="submit" class="w-full bg-ivory text-charcoal py-4 font-bold font-space tracking-widest hover:bg-white transition-colors">
                                Submit Inquiry
                            </button>
                        </form>
                        <div id="success-view" class="hidden flex-col items-center justify-center py-10 text-center">
                            <div class="w-16 h-16 border border-ivory rounded-full flex items-center justify-center mb-6 mx-auto">
                                <i data-lucide="check" class="w-8 h-8"></i>
                            </div>
                            <h3 class="text-xl font-space font-bold tracking-widest mb-2">Inquiry Received</h3>
                            <p class="text-muted text-xs tracking-wide">I'll get back to you shortly about the ${watch.name}.</p>
                        </div>
                    </div>
                </div>
            `;

            lucide.createIcons();
        }

        async function submitInquiry(formEl) {
            const watch = getWatchFromURL();
            const btn = formEl.querySelector('button[type="submit"]');
            const formData = new FormData(formEl);

            const payload = {
                type: 'WATCH_DETAIL',
                fullName: formData.get('fullName'),
                email: formData.get('email'),
                watchName: watch ? watch.name : null,
                watchRef: watch ? watch.ref : null,
                watchDetails: formData.get('message') || null
            };

            if (btn) { btn.innerText = 'Processing...'; btn.disabled = true; }

            try {
                const res = await fetch('/.netlify/functions/submit-form', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!res.ok) throw new Error('Submission failed');
                showSuccess();
            } catch (error) {
                console.error('Submission error:', error);
                if (window.location.protocol === 'file:' || (window.location.hostname === 'localhost' && error.message.includes('Failed to fetch'))) {
                    showSuccess();
                    return;
                }
                if (btn) { btn.innerText = 'Error - Try Again'; btn.disabled = false; }
            }
        }

        function showSuccess() {
            const form = document.getElementById('inquiry-form');
            const success = document.getElementById('success-view');
            if (form && success) {
                gsap.to(form, {
                    opacity: 0, height: 0, duration: 0.3,
                    onComplete: () => {
                        form.style.display = 'none';
                        success.classList.remove('hidden');
                        success.classList.add('flex');
                        gsap.fromTo(success, { opacity: 0, y: 10 },
                            { opacity: 1, y: 0, duration: 0.4, ease: 'expo.out' }
                        );
                    }
                });
            }
        }

        // INIT
        document.addEventListener('DOMContentLoaded', async () => {
            gsap.registerPlugin(ScrollTrigger);
            currentWatch = await fetchWatch();
            renderWatchDetail(currentWatch);

            // Animate in
            gsap.from('nav', { opacity: 0, y: -20, duration: 0.8, ease: 'power2.out' });

            // Stagger the main content
            setTimeout(() => {
                gsap.from('#watch-detail > div:first-child', { opacity: 0, y: 10, duration: 0.5, ease: 'power2.out' });

                const cols = document.querySelectorAll('#watch-detail .grid > div');
                if (cols.length) {
                    gsap.from(cols[0], { opacity: 0, x: -30, duration: 0.8, ease: 'power3.out', delay: 0.1 });
                    gsap.from(cols[1], { opacity: 0, x: 30, duration: 0.8, ease: 'power3.out', delay: 0.2 });
                }

                // Specs section
                const specsSection = document.querySelector('#watch-detail > div:nth-child(3)');
                if (specsSection) {
                    gsap.from(specsSection, {
                        scrollTrigger: { trigger: specsSection, start: 'top 85%' },
                        opacity: 0, y: 30, duration: 0.7, ease: 'power2.out'
                    });
                }

                // Inquiry section
                const inquirySection = document.getElementById('inquiry-section');
                if (inquirySection) {
                    gsap.from(inquirySection, {
                        scrollTrigger: { trigger: inquirySection, start: 'top 85%' },
                        opacity: 0, y: 30, duration: 0.7, ease: 'power2.out'
                    });
                }
            }, 50);
        });
    </script>
</body>
</html>
